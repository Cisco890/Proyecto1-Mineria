---
title: "Proyecto 1"
author: "Luis Pedro Lira 23669, Fernando Rocha 23501, Juan Francisco Martínez 23617, 
Luis Gilberto González - 23353, Joel Antonio Jaquez - 23369"  
date: "2026-02-02"
output:
  html_document:
    df_print: paged
  pdf_document:
    latex_engine: xelatex
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)

library(tidyverse)
library(readr)
library(ggplot2)

```

```{r}
library(readr)

divorcios <- read_csv("Datos/divorcios_total.csv")
violencia <- read_csv("Datos/violencia_total.csv")

```

```{r}
violencia <- violencia %>%
  mutate(
    # Normalizar Depto (101 -> 1)
    cod_depto = floor(hec_deptomcpio / 100),
    
    # Etiquetas de Sexo
    sexo_label = case_when(
      vic_sexo == 1 ~ "Hombre",
      vic_sexo == 2 ~ "Mujer",
      TRUE ~ "Ignorado"
    ),
    
    # Nombre de Meses
    mes_nombre = factor(month.name[hec_mes], levels = month.name),
    
    # Limpieza de Edad (Quitar 999)
    vic_edad_clean = ifelse(vic_edad > 110, NA, vic_edad),
    
    # Limpieza de Hijos (Quitar 99)
    total_hijos_clean = ifelse(total_hijos == 99, NA, total_hijos),
    
    # Etiquetas de Estado Civil
    est_civ_label = case_when(
      vic_est_civ == 1 ~ "Soltero(a)",
      vic_est_civ == 2 ~ "Casado(a)",
      vic_est_civ == 3 ~ "Unido(a)",
      TRUE ~ "Ignorado"
    ),

    # Etiquetas de Relación con Agresor (¡AQUÍ ESTÁ LO QUE FALTABA!)
    relacion_label = case_when(
      vic_rel_agr == 1 ~ "Esposo/Conviviente",
      vic_rel_agr == 2 ~ "Ex-Esposo/Ex-Pareja",
      vic_rel_agr == 3 ~ "Padre/Madre",
      vic_rel_agr == 4 ~ "Hijo(a)",
      vic_rel_agr == 5 ~ "Hermano(a)",
      TRUE ~ "Otro/No especificado"
    )
  )

# LIMPIEZA DE DIVORCIOS
divorcios <- divorcios %>%
  mutate(
    # Homologar Depto
    cod_depto = DEPOCU,
    
    # Limpieza de Edades y Diferencia
    edad_hom_clean = ifelse(EDADHOM > 110, NA, EDADHOM),
    edad_muj_clean = ifelse(EDADMUJ > 110, NA, EDADMUJ),
    diferencia_edad = edad_hom_clean - edad_muj_clean,
    
    # Etiquetas de Educación
    nivel_edu_hom = case_when(
      ESCHOM == 1 ~ "Ninguno",
      ESCHOM %in% c(2,3,4) ~ "Primaria",
      ESCHOM %in% c(5,6) ~ "Media/Diversificado",
      ESCHOM >= 7 & ESCHOM < 9 ~ "Superior",
      TRUE ~ "Ignorado"
    ),
    nivel_edu_muj = case_when(
      ESCMUJ == 1 ~ "Ninguno",
      ESCMUJ %in% c(2,3,4) ~ "Primaria",
      ESCMUJ %in% c(5,6) ~ "Media/Diversificado",
      ESCMUJ >= 7 & ESCMUJ < 9 ~ "Superior",
      TRUE ~ "Ignorado"
    )
  )
```



## Introducción 
La violencia intrafamiliar constituye un problema social de alta relevancia debido a su impacto en la estabilidad emocional, social y económica de los hogares. Por otro lado, el divorcio representa una consecuencia legal de conflictos persistentes dentro del núcleo familiar, los cuales pueden estar relacionados con dinámicas de violencia y deterioro de la convivencia.

En este proyecto se analiza la posible relación entre los divorcios y la violencia intrafamiliar utilizando datos oficiales correspondientes al año 2022. A través de técnicas de análisis exploratorio de datos y minería de datos, se busca identificar patrones, comportamientos y relaciones entre ambas problemáticas, con el fin de obtener una comprensión más profunda de su interacción a nivel agregado.

El análisis se centra en una exploración descriptiva inicial de los conjuntos de datos, la caracterización de sus variables y la evaluación de posibles relaciones estadísticas entre los indicadores de divorcio y violencia intrafamiliar.

## Objetivos 
**Objetivo General**
Analizar la relación entre los divorcios y la violencia intrafamiliar mediante técnicas de análisis exploratorio y minería de datos, utilizando información correspondiente al año 2022.

**Objetivos específicos**
- Describir las características principales de los conjuntos de datos de divorcios y violencia intrafamiliar.
- Identificar y clasificar las variables numéricas y categóricas presentes en cada conjunto de datos.
-	Realizar un análisis exploratorio de las variables relevantes mediante medidas descriptivas y representaciones gráficas.
- Evaluar posibles relaciones entre indicadores de divorcio y violencia intrafamiliar.



## Descripción general de los datos

Para el desarrollo del presente proyecto se utilizaron dos conjuntos de datos correspondientes al año 2022. El primero contiene información relacionada con los procesos de divorcio, mientras que el segundo recopila registros asociados a casos de violencia intrafamiliar. Ambos conjuntos de datos fueron obtenidos a partir de fuentes oficiales y procesados previamente para su uso en el análisis.

```{r,echo=FALSE, results='hide'}
## Dataset de divorcios

str(divorcios)
str(violencia)
```

## Descripción de las variables: Violencia intrafamiliar

El conjunto de datos de violencia intrafamiliar contiene información detallada sobre las características sociodemográficas de las víctimas y agresores, así como aspectos relacionados con el hecho de violencia reportado. Las variables incluidas permiten analizar dimensiones como edad, sexo, escolaridad, ocupación, estado civil y relación entre víctima y agresor, entre otras.


```{r, echo=FALSE, results='hide'}
## Resumen de tipos de variables en violencia

glimpse(violencia)
```
La mayoría de las variables en el conjunto de datos corresponden a codificaciones numéricas que representan categorías, mientras que otras variables como la edad y las fechas corresponden a valores numéricos continuos o discretos


## Descripción de las variables: Divorcios

El conjunto de datos de divorcios contiene información asociada a los procesos de disolución del vínculo matrimonial, incluyendo características temporales, geográficas y sociodemográficas de las personas involucradas. Las variables disponibles permiten analizar aspectos como la edad, escolaridad, ocupación y nacionalidad de los cónyuges, así como el lugar y fecha de ocurrencia del divorcio.

```{r, echo=FALSE, results='hide'}
## Resumen de variables en divorcios
glimpse(divorcios)
```

___


## Exploración de variables numéricas

En esta sección se analizan las principales variables numéricas de los conjuntos de datos de violencia intrafamiliar y divorcios, utilizando medidas de tendencia central, medidas de orden y representaciones gráficas.

```{r}
summary(violencia$vic_edad)
```

La edad de la víctima presenta un rango amplio, desde 1 hasta 98 años, lo cual evidencia que la violencia intrafamiliar afecta a personas de distintas etapas de la vida. La mediana de edad es de 31 años, mientras que la media es de aproximadamente 33 años, lo que indica una ligera asimetría positiva en la distribución. El 50% de las víctimas se concentra entre los 24 y 39 años de edad, sugiriendo que los adultos jóvenes representan el grupo más afectado. Se identificaron 5,046 registros sin información de edad, los cuales serán considerados como valores faltantes en el análisis.


```{r}
summary(violencia$total_hijos)
```

El número total de hijos de la víctima presenta una mediana de 2 hijos, lo que indica que la mayoría de los casos corresponde a personas con familias pequeñas. La media es cercana a la mediana, lo cual sugiere una distribución relativamente equilibrada. El 75% de las víctimas tiene tres hijos o menos, mientras que los valores máximos observados corresponden a casos aislados de familias numerosas. Se identificó una proporción considerable de valores faltantes, los cuales fueron tratados adecuadamente durante el análisis exploratorio.



```{r}
summary(divorcios$EDADMUJ)
```
La edad de la mujer en los procesos de divorcio presenta una mediana de 31 años y una media de aproximadamente 33 años, lo que indica que los divorcios se concentran principalmente en edades adultas jóvenes. El 50% de los casos se encuentra entre los 26 y 38 años, mientras que los valores máximos corresponden a casos aislados de edades avanzadas. La distribución muestra una ligera asimetría positiva y se identifican valores faltantes que fueron considerados adecuadamente durante el análisis.


```{r}
summary(divorcios$EDADHOM)
```

La edad del hombre en los procesos de divorcio presenta una mediana de 34 años y una media de aproximadamente 36 años, lo que sugiere que los hombres tienden a ser ligeramente mayores que las mujeres al momento del divorcio. El rango intercuartílico se ubica entre los 29 y 41 años, concentrando la mayoría de los casos en edades adultas. La distribución presenta una asimetría positiva y algunos valores extremos correspondientes a edades avanzadas.


---


## Exploración de variables categóricas

En esta sección se analizan las principales variables categóricas del conjunto de datos de violencia intrafamiliar. El objetivo es identificar la distribución de los casos según características sociodemográficas y relacionales, utilizando tablas de frecuencia y representaciones gráficas que permitan una mejor comprensión del fenómeno estudiado.

### Sexo de la víctima

Se analiza la distribución de los casos de violencia intrafamiliar según el sexo de la víctima, con el fin de identificar posibles diferencias en la afectación por género.

```{r}
# Tabla de frecuencia: sexo de la víctima
tabla_sexo <- violencia %>%
  filter(sexo_label != "Ignorado") %>%
  count(sexo_label) %>%
  mutate(porcentaje = n / sum(n) * 100)

tabla_sexo
```

```{r}
# Gráfico de barras: sexo de la víctima
ggplot(tabla_sexo, aes(x = sexo_label, y = n, fill = sexo_label)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Distribucion del sexo de las victimas",
    x = "Sexo",
    y = "Frecuencia"
  )
```
La distribución evidencia que la violencia intrafamiliar afecta de manera diferenciada según el sexo de la víctima, mostrando una concentración mayor en uno de los grupos, lo cual sugiere la presencia de desigualdades estructurales en el contexto familiar.


### Estado civil de la víctima

El estado civil de la víctima permite analizar el contexto relacional en el que ocurren los hechos de violencia intrafamiliar.

```{r}
# Tabla de frecuencia: estado civil
tabla_estado_civil <- violencia %>%
  filter(est_civ_label != "Ignorado") %>%
  count(est_civ_label) %>%
  mutate(porcentaje = n / sum(n) * 100)

tabla_estado_civil
```

```{r}
# Gráfico de barras: estado civil
ggplot(tabla_estado_civil, aes(x = est_civ_label, y = n)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Distribucion del estado civil de las victimas",
    x = "Estado civil",
    y = "Frecuencia"
  )
```
Los resultados muestran que los casos de violencia intrafamiliar se concentran principalmente en ciertos estados civiles, lo cual podría estar asociado a dinámicas de convivencia y conflictos dentro del núcleo familiar.



### Relación entre la víctima y el agresor

Se examina la relación existente entre la víctima y el agresor para identificar los vínculos más frecuentes en los casos reportados de violencia intrafamiliar.

```{r}
# Tabla de frecuencia: relación víctima-agresor
tabla_relacion <- violencia %>%
  filter(relacion_label != "Otro/No especificado") %>%
  count(relacion_label) %>%
  mutate(porcentaje = n / sum(n) * 100)

tabla_relacion
```

```{r}
# Gráfico de barras: relación víctima-agresor
ggplot(tabla_relacion, aes(x = reorder(relacion_label, -n), y = n)) +
  geom_bar(stat = "identity", fill = "coral") +
  labs(
    title = "Relacion entre la victima y el agresor",
    x = "Relacion",
    y = "Frecuencia"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
El análisis evidencia que la mayoría de los casos de violencia intrafamiliar ocurre entre personas con vínculos cercanos, lo cual refuerza la naturaleza intrafamiliar del fenómeno y resalta la importancia de analizar las relaciones personales dentro del hogar.

---

## Relaciones entre las variables. 

### Relación: Diferencia de edad entre Agresor y Víctima
```{r}
## Análisis de Brecha de Edad: Agresor vs Víctima
violencia %>%
  filter(!is.na(vic_edad_clean), !is.na(agr_edad), vic_edad_clean < 90, agr_edad < 90) %>%
  ggplot(aes(x = vic_edad_clean, y = agr_edad)) +
  geom_point(alpha = 0.1, color = "darkred") + 
  geom_abline(intercept = 0, slope = 1, color = "blue", linetype = "dashed") + 
  labs(title = "Relacion de Edades: Victima vs. Agresor",
       subtitle = "La linea azul indica la misma edad. Puntos arriba = Agresor mayor.",
       x = "Edad de la Victima",
       y = "Edad del Agresor") +
  theme_minimal()
```
El gráfico de dispersión analiza la brecha generacional existente entre la víctima y el agresor en los casos de violencia intrafamiliar. La línea azul discontinua representa la igualdad de edades; por lo tanto, la notable concentración de puntos por encima de esta referencia evidencia que, en la mayoría de los casos reportados, el agresor tiende a ser mayor que la víctima, lo cual sugiere una posible asimetría de poder vinculada a la edad. Adicionalmente, se observa una alta densidad de incidentes (la "nube" más oscura) donde ambas partes oscilan entre los 20 y 40 años, identificando a los adultos jóvenes como el grupo demográfico más vulnerable y activo en esta problemática.


### Relación: Estacionalidad de la Violencia (Mes del hecho)
```{r}
## Análisis Temporal: Violencia por Mes
violencia %>%
  filter(!is.na(mes_nombre)) %>%
  group_by(mes_nombre) %>%
  summarise(total = n()) %>%
  ggplot(aes(x = mes_nombre, y = total)) +
  geom_col(fill = "steelblue") +
  labs(title = "Estacionalidad de la Violencia Intrafamiliar",
       x = "Mes",
       y = "Cantidad de Denuncias") +
  theme_classic()
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
El análisis de estacionalidad revela que la incidencia de violencia intrafamiliar mantiene un comportamiento relativamente constante y sostenido durante gran parte del año, sin caídas drásticas. Se observan ligeros repuntes en los meses de marzo, mayo y julio, los cuales concentran los volúmenes más altos de denuncias (superando los 30,000 casos mensuales). Por otro lado, se percibe una leve tendencia decreciente hacia el último trimestre (octubre a diciembre). Cabe destacar la presencia de una barra etiquetada como "99", la cual corresponde a registros donde el mes de ocurrencia no fue especificado o es desconocido, evidenciando la necesidad de considerar estos valores nulos durante la limpieza de datos para evitar sesgos en el análisis temporal.

## Relación: Nivel Educativo de la Pareja (Homogamia)

```{r}
divorcios %>%
  filter(nivel_edu_hom != "Ignorado", nivel_edu_muj != "Ignorado") %>%
  group_by(nivel_edu_hom, nivel_edu_muj) %>%
  count() %>%
  ggplot(aes(x = nivel_edu_hom, y = nivel_edu_muj, fill = n)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "red") +
  labs(title = "Mapa de Calor: Nivel Educativo en Divorcios",
       subtitle = "Comparación de escolaridad entre cónyuges",
       x = "Escolaridad del Hombre",
       y = "Escolaridad de la Mujer",
       fill = "Cantidad") +
  theme_minimal()
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

El análisis de la matriz educativa revela una marcada tendencia hacia la homogamia educativa en las disoluciones matrimoniales. Se observa una concentración de casos a lo largo de la diagonal principal (donde el nivel educativo del hombre y la mujer coinciden), lo que sugiere que las parejas tienden a formarse —y consecuentemente a divorciarse— dentro de sus mismos estratos académicos. Sin embargo, el hallazgo más crítico desde la perspectiva de la minería de datos es la alta densidad observada en la intersección de los códigos "9" (esquina superior derecha, color rojo intenso). Dado que este código corresponde a valores "Ignorados" o "No indicados" en los estándares del INE, esto evidencia un sesgo de información faltante significativo; es decir, en una gran proporción de los divorcios registrados, no se capturó el nivel educativo de ninguno de los cónyuges, lo cual limita la caracterización sociodemográfica precisa de este subgrupo.

## Relacion: Distribución de la Diferencia de Edad en Divorcios

```{r}
divorcios %>%
  filter(!is.na(diferencia_edad)) %>%
  filter(diferencia_edad > -20, diferencia_edad < 30) %>% # Filtramos casos extremos errores
  ggplot(aes(x = diferencia_edad)) +
  geom_histogram(binwidth = 1, fill = "purple", color = "white") +
  geom_vline(xintercept = 0, color = "black", size = 1) +
  labs(title = "Diferencia de Edad en Parejas que se Divorcian",
       subtitle = "Valores positivos: Hombre mayor. Valores negativos: Mujer mayor.",
       x = "Annos de diferencia (Edad Hombre - Edad Mujer)",
       y = "Frecuencia") +
  theme_light()
```

El histograma de distribución de edades en los divorcios muestra una clara asimetría positiva (sesgo hacia la derecha). La mayor concentración de datos se agrupa alrededor de la línea cero, indicando que una gran parte de las disoluciones matrimoniales ocurre en parejas con edades similares (homogamia etaria). Sin embargo, la cola derecha de la distribución es notablemente más larga y densa que la izquierda, lo que revela un patrón social predominante: en las parejas con diferencias de edad significativas que llegan al divorcio, es mucho más frecuente que el hombre sea mayor que la mujer (barras púrpuras extendiéndose hacia los valores positivos). Por el contrario, los casos donde la mujer es considerablemente mayor que el hombre (valores negativos) son estadísticamente menos frecuentes.






