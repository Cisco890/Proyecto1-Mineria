knitr::opts_chunk$set(echo = TRUE)
library(haven)
install.packages('heaven')
install.packages('haven')
install.packages('purrr')
library(haven)
library(dplyr)
library(purrr)
library(stringr)
# 1) Folder where your .sav files are
ruta <- "C:/ruta/a/tu/carpeta"   # <- cambia esto
# 2) List all .sav files
archivos <- list.files(ruta, pattern = "\\.sav$", full.names = TRUE)
# 3) Read + add a "year" column inferred from filename (optional)
#    This tries to find a 4-digit year like 2019, 2020, etc.
datos_list <- map(archivos, ~{
df <- read_sav(.x)
anio <- str_extract(basename(.x), "(19|20)\\d{2}")  # e.g., "2021"
df <- df %>% mutate(year = as.integer(anio))
df
})
# 4) Bind all rows, even if columns differ across years
#    (missing columns become NA automatically)
datos_total <- bind_rows(datos_list)
# View result
glimpse(datos_total)
### Export the combined file
**To SPSS again (.sav):**
# ruta de los archivos
ruta <- "D:\Documentos_Universidad\cuarto\Primer_semestre\Mineria_datos\Proyecto 1"
# ruta de los archivos
ruta <- "D:\Documentos_Universidad\cuarto\Primer_semestre\Mineria_datos\Proyecto 1"
# ruta de los archivos
ruta <- "D:\Documentos_Universidad\cuarto\Primer_semestre\Mineria_datos\Proyecto 1"
# ruta de los archivos
ruta <- "D:/Documentos_Universidad/cuarto/Primer_semestre/Mineria_datos/Proyecto 1"
# Listar todos los archivos disponibles
archivos <- list.files(ruta, pattern = "\\.sav$", full.names = TRUE)
# Agregar el año basado en la metadata
datos_list <- map(archivos, ~{
df <- read_sav(.x)
anio <- str_extract(basename(.x), "(19|20)\\d{2}")  # e.g., "2021"
df <- df %>% mutate(year = as.integer(anio))
df
})
# Combinar las filas
datos_total <- bind_rows(datos_list)
# resultados
glimpse(datos_total)
# ruta de los archivos
ruta <- "D:/Documentos_Universidad/cuarto/Primer_semestre/Mineria_datos/Proyecto 1"
# Listar todos los archivos disponibles
archivos <- list.files(ruta, pattern = "\\.sav", full.names = TRUE)
# Agregar el año basado en la metadata
datos_list <- map(archivos, ~{
df <- read_sav(.x)
anio <- str_extract(basename(.x), "(19|20)\\d{2}")  # e.g., "2021"
df <- df %>% mutate(year = as.integer(anio))
df
})
# Combinar las filas
datos_total <- bind_rows(datos_list)
# resultados
glimpse(datos_total)
# ruta de los archivos
ruta <- "D:/Documentos_Universidad/cuarto/Primer_semestre/Mineria_datos/Proyecto 1"
# Listar todos los archivos disponibles
archivos <- list.files(ruta, pattern = "\\.SAV File", full.names = TRUE)
# Agregar el año basado en la metadata
datos_list <- map(archivos, ~{
df <- read_sav(.x)
anio <- str_extract(basename(.x), "(19|20)\\d{2}")  # e.g., "2021"
df <- df %>% mutate(year = as.integer(anio))
df
})
# Combinar las filas
datos_total <- bind_rows(datos_list)
# resultados
glimpse(datos_total)
library(haven)
library(dplyr)
library(purrr)
library(stringr)
# ruta de los archivos
ruta <- "D:/Documentos_Universidad/cuarto/Primer_semestre/Mineria_datos/Proyecto 1"
# Listar todos los archivos disponibles
archivos <- list.files(ruta, pattern = "\\.SAV File", full.names = TRUE)
# Agregar el año basado en la metadata
datos_list <- map(archivos, ~{
df <- read_sav(.x)
anio <- str_extract(basename(.x), "(19|20)\\d{2}")  # e.g., "2021"
df <- df %>% mutate(year = as.integer(anio))
df
})
# Combinar las filas
datos_total <- bind_rows(datos_list)
# resultados
glimpse(datos_total)
ruta <- "D:/Documentos_Universidad/cuarto/Primer_semestre/Mineria_datos/Proyecto 1"
# 1) Does the folder exist?
dir.exists(ruta)
# 2) What files are in there (first 30)?
list.files(ruta)[1:30]
# 3) Find .sav files
archivos <- list.files(ruta, pattern = "\\.sav$", full.names = TRUE)
length(archivos)
archivos
View(datos_total)
library(readxl)
library(readr)
# =========================
# Dataset de Divorcios
# =========================
divorcios_raw <- read_excel(
path = "Datos/diccionario_divorcios_2022.xlsx",
sheet = "Divorcios"
)
write_csv(
divorcios_raw,
"Datos/divorcios_2022.csv"
)
# =========================
# Dataset de Violencia
# =========================
violencia_raw <- read_excel(
path = "Datos/diccionario_violencia_2022.xlsx"
)
write_csv(
violencia_raw,
"Datos/violencia_2022.csv"
)
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = TRUE)
# Install (only if missing)
library(haven)
library(dplyr)
library(purrr)
library(stringr)
library(tibble)
ruta <- "D:/Documentos_Universidad/cuarto/Primer_semestre/Mineria_datos/Proyecto1/Divorcios"
stopifnot(dir.exists(ruta))
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = TRUE)
library(haven)
library(dplyr)
library(purrr)
library(stringr)
library(tibble)
library(janitor)
ruta <- "D:/Documentos_Universidad/cuarto/Primer_semestre/Mineria_datos/Proyecto1/Violencia"
stopifnot(dir.exists(ruta))
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
library(tidyverse)
library(readr)
library(readr)
divorcios <- read_csv("Datos/divorcios_total.csv")
violencia <- read_csv("Datos/violencia_total.csv")
## Dataset de divorcios
str(divorcios)
str(violencia)
## Resumen de tipos de variables en violencia
glimpse(violencia)
violencia <- violencia %>%
mutate(
vic_edad = ifelse(vic_edad %in% c(99, 999), NA, vic_edad)
)
## Resumen de variables en divorcios
glimpse(divorcios)
divorcios <- divorcios %>%
mutate(
EDADHOM = ifelse(EDADHOM == 999, NA, EDADHOM),
EDADMUJ = ifelse(EDADMUJ == 999, NA, EDADMUJ)
)
summary(violencia$vic_edad)
violencia <- violencia %>%
mutate(
total_hijos = ifelse(total_hijos == 99, NA, total_hijos)
)
summary(violencia$total_hijos)
divorcios <- divorcios %>%
mutate(
EDADMUJ = ifelse(EDADMUJ == 999, NA, EDADMUJ),
EDADHOM = ifelse(EDADHOM == 999, NA, EDADHOM)
)
summary(divorcios$EDADMUJ)
summary(divorcios$EDADHOM)
# Tabla de frecuencia: sexo de la víctima
tabla_sexo <- violencia %>%
filter(!is.na(vic_sexo)) %>%
count(vic_sexo) %>%
mutate(porcentaje = n / sum(n) * 100)
tabla_sexo
# Gráfico de barras: sexo de la víctima
ggplot(tabla_sexo, aes(x = factor(vic_sexo), y = n)) +
geom_bar(stat = "identity") +
labs(
title = "Distribución del sexo de las víctimas",
x = "Sexo",
y = "Frecuencia"
)
# Tabla de frecuencia: estado civil
tabla_estado_civil <- violencia %>%
filter(!is.na(vic_est_civ)) %>%
count(vic_est_civ) %>%
mutate(porcentaje = n / sum(n) * 100)
tabla_estado_civil
# Gráfico de barras: estado civil
ggplot(tabla_estado_civil, aes(x = factor(vic_est_civ), y = n)) +
geom_bar(stat = "identity") +
labs(
title = "Distribución del estado civil de las víctimas",
x = "Estado civil",
y = "Frecuencia"
)
# Tabla de frecuencia: relación víctima-agresor
tabla_relacion <- violencia %>%
filter(!is.na(vic_rel_agr)) %>%
count(vic_rel_agr) %>%
mutate(porcentaje = n / sum(n) * 100)
tabla_relacion
# Gráfico de barras: relación víctima-agresor
ggplot(tabla_relacion, aes(x = factor(vic_rel_agr), y = n)) +
geom_bar(stat = "identity") +
labs(
title = "Relación entre la víctima y el agresor",
x = "Relación",
y = "Frecuencia"
)
View(tabla_relacion)
View(tabla_sexo)
View(tabla_estado_civil)
glimpse(violencia)
glimpse(divorcios)
## Análisis de Brecha de Edad: Agresor vs Víctima
violencia %>%
filter(!is.na(vic_edad), !is.na(agr_edad), vic_edad < 90, agr_edad < 90) %>%
ggplot(aes(x = vic_edad, y = agr_edad)) +
geom_point(alpha = 0.1, color = "darkred") +
geom_abline(intercept = 0, slope = 1, color = "blue", linetype = "dashed") +
labs(title = "Relación de Edades: Víctima vs. Agresor",
subtitle = "La línea azul indica la misma edad. Puntos arriba = Agresor mayor.",
x = "Edad de la Víctima",
y = "Edad del Agresor") +
theme_minimal()
## Análisis Temporal: Violencia por Mes
violencia %>%
filter(!is.na(hec_mes)) %>%
group_by(hec_mes) %>%
summarise(total = n()) %>%
ggplot(aes(x = factor(hec_mes), y = total)) +
geom_col(fill = "steelblue") +
labs(title = "Estacionalidad de la Violencia Intrafamiliar",
x = "Mes del Año (1 = Enero, 12 = Diciembre)",
y = "Cantidad de Denuncias") +
theme_classic()
